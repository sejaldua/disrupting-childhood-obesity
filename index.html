<!DOCTYPE html>
  <meta charset="utf-8">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <title>Disrupting Childhood Obesity</title>
  <h1 class="title">Visualizing the Relationship between Obesity and Contributing Factors</h1></br>
  <h4 class="title">Obese children are approximately 5 times more likely to become obese adults &#8224;. Several factors contribute to both adult and childhood obesity.</h4> 
  <h4 class="title">Nutrition, Physical Activity, and Obesity - Youth Risk Behavior Surveillance System data can be found <a href="https://chronicdata.cdc.gov/Nutrition-Physical-Activity-and-Obesity/Nutrition-Physical-Activity-and-Obesity-Youth-Risk/vba9-s8jp">here.</a></h4>
  <div class="row">
    <div class="column2" style="position: relative; max-height:6vw; min-height:30px">
      <div id="slider_div">
        <h4 id="sliderinfo"></h4>
        <div class="row">
          <input type="range" min="0" max="9" value="9" class="slider" id="myRange"><div id="year" style="margin-top:-1.5%"></div>
        </div>   
      </div> 
      <div id="alertdiv" style="display:none"></div>
    </div>
    <div class="dropdown" style="position:absolute; z-index:100; margin-left:82%">
      <div class="row">
        <div class="column2" style="width:150%">
            <button class="dropbtn">Change Factor &#9660;</button>
        </div>
        <div class="column3" style="margin-top:13%; margin-left:4%">
            <a href="#" data-toggle="tooltip" data-placement="left" title="Hooray!"><i class="fa fa-info-circle" style="font-size:24px"></i></a>
        </div>
      </div>
        
        <form id= "radio_options" class="dropdown-content">
            <input type="radio" name="dem_radio" value="income" id="income_check" checked>Median Income
              <label class="dem_option" for="income_check"></label>
            <br>
            <input type="radio" name="dem_radio" value="unemp" id="unemployment_check">Unemployment Rate
            <label class="dem_option" for="politics_check"></label>
            <br>
            <input type="radio" name="dem_radio" value="poverty" id="poverty_check">Childhood Poverty Rate
            <label class="dem_option" for="poverty_check"></label>
        </form>
        <h2 class="title bubbleTitle" style="margin-top:10%; position:absolute" id="pageTitle"></h2>
      </div>  
  </div>

    
  <div class="row">
      <div class="column1" style="position: sticky; margin-top:10px;">
        <h2 class="title" id="pageTitle">Regional Adult Obesity Rates</h2>
        <svg id="maps" style="max-height:44vw; min-height:200px"></svg>
        <div style="margin-top:-10%" id="map-legend"></div>
      </div>
      <div class="column3" style="position:sticky; width:100%; margin-left:3%">
          <svg id="bubbles" style="height:1250px; width:275px"></svg>
      </div>
    </div>
 <h4 class="title">Size of bubble reflects county population</h4>
  </div>

<footer>
  <h4 class="title" style="margin-top:-2.5%">Made with &#10084; by Sook-Hee Evans, Sejal Dua, and Gerard Frasca <br> &#8224;Simmonds M, Llewellyn A, Owen CG, Woolacott N. Predicting adult obesity from childhood obesity: a systematic review and meta-analysis. Obes Rev. 2016 Feb;17(2):95-107. doi: 10.1111/obr.12334. Epub 2015 Dec 23. PMID: 26696565.</h4>
</footer>

<script src="js/d3.v4.min.js"></script>
<script src="js/topojson.v1.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/0.10.0/lodash.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="js/d3-tip.js"></script>
<script type = "text/javascript" src="jsons/data_2011.json"></script>
<script type = "text/javascript" src="jsons/data_2012.json"></script>
<script type = "text/javascript" src="jsons/data_2013.json"></script>
<script type = "text/javascript" src="jsons/data_2014.json"></script>
<script type = "text/javascript" src="jsons/data_2015.json"></script>
<script type = "text/javascript" src="jsons/data_2016.json"></script>
<script type = "text/javascript" src="jsons/data_2017.json"></script>
<script type = "text/javascript" src="jsons/data_2018.json"></script>
<script type = "text/javascript" src="jsons/data_2019.json"></script>
<script type = "text/javascript" src="jsons/data_2020.json"></script>
<script type = "text/javascript" src="move_index.json"></script>
<script type = "text/javascript" src="us-county-cases.json"></script>
<script type = "text/javascript" src="trends/income_pos.json"></script>
<script type = "text/javascript" src="trends/pos-vote.json"></script>
<script type = "text/javascript" src="trends/unemployment.json"></script>
<script type = "text/javascript" src="trends/unemp.json"></script>
<script type = "text/javascript" src="trends/demographic-data.json"></script>
<script type = "text/javascript" src="trends/trends.js"></script>
<script type="text/javascript" src="js/map.js"></script>
<script type="text/javascript" src="js/linking.js"></script>
<script type="text/javascript" src="js/setup.js"></script>
<script type = "text/javascript" src="js/d3-legend.min.js"> </script>
<script type = "text/javascript" src="js/detect_location.js"> </script>
<script>
$(document).ready(function(){
  $('[data-toggle="tooltip"]').tooltip();   
});
us_state_abbrev = {
    'Alabama': 'AL',
    'Alaska': 'AK',
    'American Samoa': 'AS',
    'Arizona': 'AZ',
    'Arkansas': 'AR',
    'California': 'CA',
    'Colorado': 'CO',
    'Connecticut': 'CT',
    'Delaware': 'DE',
    'District of Columbia': 'DC',
    'Florida': 'FL',
    'Georgia': 'GA',
    'Guam': 'GU',
    'Hawaii': 'HI',
    'Idaho': 'ID',
    'Illinois': 'IL',
    'Indiana': 'IN',
    'Iowa': 'IA',
    'Kansas': 'KS',
    'Kentucky': 'KY',
    'Louisiana': 'LA',
    'Maine': 'ME',
    'Maryland': 'MD',
    'Massachusetts': 'MA',
    'Michigan': 'MI',
    'Minnesota': 'MN',
    'Mississippi': 'MS',
    'Missouri': 'MO',
    'Montana': 'MT',
    'Nebraska': 'NE',
    'Nevada': 'NV',
    'New Hampshire': 'NH',
    'New Jersey': 'NJ',
    'New Mexico': 'NM',
    'New York': 'NY',
    'North Carolina': 'NC',
    'North Dakota': 'ND',
    'Northern Mariana Islands':'MP',
    'Ohio': 'OH',
    'Oklahoma': 'OK',
    'Oregon': 'OR',
    'Pennsylvania': 'PA',
    'Puerto Rico': 'PR',
    'Rhode Island': 'RI',
    'South Carolina': 'SC',
    'South Dakota': 'SD',
    'Tennessee': 'TN',
    'Texas': 'TX',
    'Utah': 'UT',
    'Vermont': 'VT',
    'Virgin Islands': 'VI',
    'Virginia': 'VA',
    'Washington': 'WA',
    'West Virginia': 'WV',
    'Wisconsin': 'WI',
    'Wyoming': 'WY'
}

d3.select("#sliderinfo")
.text("Slide to explore yearly changes in obesity.")

var margin = {top: 10, left: 10, bottom: 10, right: 10}
  , width = $("body").width() / 1.1
  , width = width - margin.left - margin.right
  , mapRatio = .5
  , height = width * mapRatio;

var svg = d3.select("#maps")
    .style('width', width + 'px')
    .style('height', height + 'px')

d3.select("svg").style("cursor", "crosshair");

var county_dict = d3.map();
var state_fips_dict = d3.map();
data_2018.forEach( function(d){ county_dict.set( d.FIPS, d.County) });
data_2018.forEach( function(d){ state_fips_dict.set( d.FIPS, d.State) });


var years = ["2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020"];
var selected_fips = null;
// var old_colors = ["#9adbb5", "rgb(205, 235, 178)", "#F6F5AE", "rgb(253, 223, 158)", "rgb(211, 85, 65)"];
var colors = ["#b6e060", "#f5ea6e", "#fac55a", "#FF8E15", "#FF0D0D"];
var quantize = d3.scaleQuantize()
      .domain([10, 60])
      .range(d3.range(5).map(function(i) { 
        return colors[i];
      }))

// var quantize = d3.scaleLinear()
//     .domain([10, 60])
//     .range(["#69B34C", "#FF0D0D"])
//     .interpolate(d3.interpolateHcl);

var projection = d3.geoAlbersUsa()
    .scale(width)
    .translate([width / 2.4, height / 2]);

var path = d3.geoPath()
    .projection(projection);

var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-5, 0])
  .html(function(d) {
    var dataRow = county_dict.get(d.id)
    if (dataRow) {
      var val = document.getElementById("myRange").value;
      return "County: " + toTitleCase(county_dict.get(d.id)) + " (" + us_state_abbrev[state_fips_dict.get(d.id)] + ")" + "<br>Obesity Rate: " + move_dict.get(d.id)
      
    } else {
        return county_dict.get(d.id) + ": No data.";
    }
  })

svg.call(tip)

var ordinal = d3.scaleOrdinal()
  .domain(["< 20%", "20%", "30%", "40%", "50% >="])
  // .range(["rgb(154,219,181)", "rgb(205, 235, 178)", "rgb(246,245,174)", 
  //         "rgb(253, 223, 158)", "rgb(211, 85, 65)"]);
  .range(colors);

var legend = d3.select("#map-legend").append("svg");

legend.append("g")
  .attr("class", "legend")
  .attr("transform", "translate(20,20)");

var move_legend = d3.legendColor()
  .shapeWidth(50)
  .orient('horizontal')
  .scale(ordinal)
  .title("Obesity Rates (Lower Bound)");

legend.select(".legend")
  .call(move_legend)

// legend.selectAll("rect")
//   .on("mouseover", highlight_move)
//   .on("mouseout", unhighlight)

d3.queue()
    .defer(d3.json, "https://raw.githubusercontent.com/sevans09/Vizathon/main/us.json?token=AKKXA7SAJLELQT4KYMOA3B3AA4EAG")
    .await(ready);

$("#queriedCounty").on('focus', unhighlight);
</script>
