<!DOCTYPE html>
  <meta charset="utf-8">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">


  <title>Disrupting Childhood Obesity</title>
  <h1 class="title">Visualizing the Relationship between Obesity and Contributing Factors</h1></br>
  <h4 class="title">XX% of overweight or obese adults were obese as children.</h4> 
  <h4 class="title">Nutrition, Physical Activity, and Obesity - Youth Risk Behavior Surveillance System data can be found <a href="https://chronicdata.cdc.gov/Nutrition-Physical-Activity-and-Obesity/Nutrition-Physical-Activity-and-Obesity-Youth-Risk/vba9-s8jp">here.</a></h4>
  <div class="row">
    <div class="column2" style="position: relative; max-height:6vw; min-height:30px">
      <div id="slider_div">
        <h4 id="sliderinfo"></h4>
        <div class="row">
          <input type="range" min="0" max="9" value="9" class="slider" id="myRange"><div id="year"></div>
        </div>   
      </div> 
      <div id="alertdiv" style="display:none"></div>
    </div>
  </div>
  <div class="dropdown" style="float:right; display:block">
      <button class="dropbtn">Contributing Factors &#9660;</button>
      <div class="dropdown-content">
      <a href="#">Median Household Income</a>
      <a href="#">Var 2</a>
      <a href="#">Var 3</a>
      </div>
    </div>  
    
  <div class="row">
      <div class="column1" style="position: sticky; margin-top:10px;">
        <a href="#" id="toggleButton" value="MAP" class="myButton" style="display: none; margin-bottom: -5%; position: relative; z-index: 1; float: right; margin-right: 5%"style>Switch to Demographic Trends</a>
        <svg id="maps" style="max-height:44vw; min-height:200px"></svg>
        <div style="margin-top:-10%" id="map-legend"></div>
      </div>
    </div>
  </div>
  <div class="row">
    <div id= "dem_options" style="position: relative; margin-bottom: -15%; margin-top: 3%; border: 1px #000000 solid; padding: 0px 10px 10px 10px;float: left; margin-left: 5%; visibility: hidden">
      <div id= "option_title"><h3 style="margin-bottom: 5px">Filter by Demographic</h3></div>
        <form id= "radio_options">
          <input type="radio" name="dem_radio" value="income" id="income_check" checked>Income
            <label class="dem_option" for="income_check"></label>
          <br>
          <input type="radio" name="dem_radio" value="vote" id="politics_check">Politics
          <label class="dem_option" for="income_check"></label>
          <br>
          <input type="radio" name="dem_radio" value="unemp" id="unemployment_check">Unemployment
          <label class="dem_option" for="politics_check"></label>
      </form>
    </div>
    <svg id="bubbles" style="max-height:100%; min-height:200px; width:100%"></svg>
  </div>

<footer>
  <h4 class="title">Made with &#10084; by Sook-Hee Evans, Sejal Dua, and Gerard Frasca</h4>
</footer>

<script src="js/d3.v4.min.js"></script>
<script src="js/topojson.v1.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/0.10.0/lodash.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="js/d3-tip.js"></script>
<script type = "text/javascript" src="jsons/data_2011.json"></script>
<script type = "text/javascript" src="jsons/data_2012.json"></script>
<script type = "text/javascript" src="jsons/data_2013.json"></script>
<script type = "text/javascript" src="jsons/data_2014.json"></script>
<script type = "text/javascript" src="jsons/data_2015.json"></script>
<script type = "text/javascript" src="jsons/data_2016.json"></script>
<script type = "text/javascript" src="jsons/data_2017.json"></script>
<script type = "text/javascript" src="jsons/data_2018.json"></script>
<script type = "text/javascript" src="jsons/data_2019.json"></script>
<script type = "text/javascript" src="jsons/data_2020.json"></script>
<script type = "text/javascript" src="move_index.json"></script>
<script type = "text/javascript" src="us-county-cases.json"></script>
<script type = "text/javascript" src="trends/income_pos.json"></script>
<script type = "text/javascript" src="trends/pos-vote.json"></script>
<script type = "text/javascript" src="trends/unemployment.json"></script>
<script type = "text/javascript" src="trends/unemp.json"></script>
<script type = "text/javascript" src="trends/demographic-data.json"></script>
<script type = "text/javascript" src="trends/trends.js"></script>
<script type="text/javascript" src="js/bar.js"></script>
<script type="text/javascript" src="js/map.js"></script>
<script type="text/javascript" src="js/movement.js"></script>
<script type="text/javascript" src="js/query.js"></script>
<script type="text/javascript" src="js/setup.js"></script>
<script type = "text/javascript" src="js/d3-legend.min.js"> </script>
<script type = "text/javascript" src="js/detect_location.js"> </script>
<script>

d3.select("#sliderinfo")
.text("Slide to explore yearly changes in obesity.")

var margin = {top: 10, left: 10, bottom: 10, right: 10}
  , width = $("body").width() / 1.1
  , width = width - margin.left - margin.right
  , mapRatio = .5
  , height = width * mapRatio;

var svg = d3.select("#maps")
    .style('width', width + 'px')
    .style('height', height + 'px')

d3.select("svg").style("cursor", "crosshair");

var county_dict = d3.map();
data_2018.forEach( function(d){ county_dict.set( d.FIPS, d.County) });

var states_dict = d3.map();
var state_names_dict = d3.map();
var names_dict = {};
var names_and_county_dict = d3.map();

var years = ["2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020"];

var selected_fips = null;
var selected_state = null;

var quantize = d3.scaleQuantize()
      .domain([0, 50])
      .range(d3.range(5).map(function(i) { 
        if (i == 0)
              return "#9adbb5";
          else if (i == 1)
              return "rgb(205, 235, 178)";
          else if (i == 2)
              return "#F6F5AE";
          else if (i == 3)
              return "rgb(253, 223, 158)";
          else
              return "rgb(211, 85, 65)";
      }))

var projection = d3.geoAlbersUsa()
    .scale(width)
    .translate([width / 2.4, height / 2]);

var path = d3.geoPath()
    .projection(projection);

var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-5, 0])
  .html(function(d) {
    var dataRow = county_dict.get(d.id)
    if (dataRow) {
      var val = document.getElementById("myRange").value;
      return "County: " + toTitleCase(county_dict.get(d.id))  + "<br>Obesity Rate: " + move_dict.get(d.id)
    } else {
        return county_dict.get(d.id) + ": No data.";
    }
  })

svg.call(tip)

var ordinal = d3.scaleOrdinal()
  .domain(["< 10%", "10%", "20%", "30%", "40% >="])
  .range(["rgb(154,219,181)", "rgb(205, 235, 178)", "rgb(246,245,174)", 
          "rgb(253, 223, 158)", "rgb(211, 85, 65)"]);

var legend = d3.select("#map-legend").append("svg");

legend.append("g")
  .attr("class", "legend")
  .attr("transform", "translate(20,20)");

var move_legend = d3.legendColor()
  .shapeWidth(50)
  .orient('horizontal')
  .scale(ordinal)
  .title("Move Index");

legend.select(".legend")
  .call(move_legend)

legend.selectAll("rect")
  .on("mouseover", highlight_move)
  .on("mouseout", unhighlight)

d3.queue()
    .defer(d3.json, "https://raw.githubusercontent.com/sevans09/Vizathon/main/us.json?token=AKKXA7SAJLELQT4KYMOA3B3AA4EAG")
    .await(ready);

$("#queriedCounty").on('focus', unhighlight);
</script>
